(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const x=(n,e,t,r)=>{const s=new Uint8Array(n.memory.buffer,e,t),i=new Uint8Array(s.length);return i.set(s),n.exports.mfree(e,r),i},T=(n,e)=>{const t=new Uint32Array(n.memory.buffer,e,3),r=t[0],s=t[1],i=t[2];return n.exports.mfree(e,12),x(n,r,s,i)},_=(n,e)=>{const t=n.exports.malloc(e.length);return new Uint8Array(n.memory.buffer).set(e,t),t},R=async n=>{let e=null;const t=new TextDecoder("utf-8"),r={alert:(c,a,l)=>{if(!e)return;const d=x(e,c,a,l),u=t.decode(d);console.error(u)},print:(c,a,l)=>{if(!e)return;const d=x(e,c,a,l),u=t.decode(d);console.log(u)}},i=await(await fetch(n)).arrayBuffer(),o=await WebAssembly.instantiate(i,{env:r});return e={exports:o.instance.exports,memory:o.instance.exports.memory},e},p={spiral:["size = 600;","","func shape(c, s) {","  i = 0;","","  while (i < c * s) {","    forward (size / c);","    right (360 / c);","    i = i + 1;","  }","}","","left 30;","forward size * 0.5;","x = 41;","","while (x > 0) {","  shape(55, 0.5);","  right 90;","  shape(55, 0.5);","  x = x - 1;","}"],koch:["func min(a, b) {","  if a < b {","    return a;","  }","","  return b;","}","","func segment(n, length) {","  if n == 0 {","    forward length;","    return;","  }","","  l = (length / 3);","","  segment(n - 1, l);","  left 60;","  segment(n - 1, l);","  right 120;","  segment(n - 1, l);","  left 60;","  segment(n - 1, l);","}","","func triangle(n, length) {","  left 60;","  segment(n, length);","  right 120;","  segment(n, length);","  right 120;","  segment(n, length);","  left 180;","}","","i = min(3, 5);","","while i < 6 {","  triangle(i, 400);","  i = i + 1;","}",""],emoji_test:["cowðŸ¤ boy = 200;","forward cowðŸ¤ boy;","right 90;","forward cowðŸ¤ boy;","right 90;","forward cowðŸ¤ boy;","right 90;","forward cowðŸ¤ boy;"]},L=48,N=49,A=50,S=51,B=52,M=53,b=54,D=55,j=56,F=57,W=58,$=101,H=108,h=(n,e)=>{let t=0;for(;n[e]!=W&&e<n.length;)t=n[e]-L+t*10,e=e+1;return e=e+1,{value:n.subarray(e,e+t),end:e+t}},U=(n,e)=>{let t=e+1,r=[];for(;n[t]!=$;){const{value:s,end:i}=O(n,t);r.push(s),t=i}return{value:r,end:t+1}},O=(n,e=0)=>{const t=n[e];switch(t){case H:return U(n,e);case L:return h(n,e);case N:return h(n,e);case A:return h(n,e);case S:return h(n,e);case B:return h(n,e);case M:return h(n,e);case b:return h(n,e);case D:return h(n,e);case j:return h(n,e);case F:return h(n,e)}throw new Error("Error while decoding. Reading "+t+" at "+e)},P=n=>n===1?"number":n===2?"identifier":n===3?"keyword":n===4?"move":n===10?"func":n===11?"call":n===20?"comment":n===40?"error":void 0,k=n=>n>1||n===1?"lint":void 0,q=(n,e)=>{const t=new TextDecoder("utf-8"),r=new TextEncoder().encode(e),s=_(n,r),i=n.exports.syntax_fragments(s,r.length),o=T(n,i),[c,a]=O(o).value;return c.map(l=>({fragments:l.map(d=>{let u=d[0],f=d[1],g=d.subarray(2,d.length);return console.log(u),{value:t.decode(g),kind:P(u),error:k(f),hint:f>1?t.decode(a[f]):void 0}})}))};function z(n){return n.length===0?"":n[n.length-1]}function w(n,e){if(!e.length)return n;const[t,...r]=e;return[...n.slice(0,-1),z(n)+t,...r]}function I(n,e){const t=n.slice(0,e.lineIndex+1),r=n.slice(e.lineIndex);return t[t.length-1]=t[t.length-1].slice(0,e.charIndex),r.length&&(r[0]=r[0].slice(e.charIndex)),[t,r]}function m(n,e,t){const[r,s]=I(n,t),[i,o]=I(r,e);return w(i,s)}function C(n,e,t){const[r,s]=I(n,t);return w(w(r,e),s)}function v(n,e,t){const r=n.slice(0,e),s=n.slice(t+1),i=n.slice(e,t+1).join("");return[...r,i,...s]}function E(n,e,t,r){const s=n.slice(0,e),i=n.slice(e+1),o=n[e],c=o.slice(0,t)+o.slice(r);return[...s,c,...i]}const V=/[\s-\+\*\/\\\(\)\.\[\]\{\}\;\=\:\<\>\?\%\^\!\@\#\$\&\`\'\"]/;class G extends EventTarget{gutter;input;module;content;caret;constructor(e,t){super();const[r,s]=this.createElement(e);this.gutter=r,this.input=s,this.module=t,this.content=[""],this.caret=null,this.input.addEventListener("beforeinput",i=>{i.preventDefault();const o=i;o.inputType!=="insertCompositionText"&&(o.isComposing||(this.caret=this.handleInputEvent(i),this.setCaret(this.caret)))}),this.input.addEventListener("input",i=>{i.preventDefault();const o=i;o.isComposing||o.isTrusted&&(this.render(),this.setCaret(this.caret))}),this.input.addEventListener("compositionend",i=>{i.preventDefault(),this.caret=this.insertText(i.data),this.setCaret(this.caret)}),this.input.addEventListener("keydown",i=>{if(i.key==="Tab"){const o=this.getCaret()?.from.charIndex??0,c=o%4==0?"    ":" ".repeat(o%4);this.insertText(c),i.preventDefault()}}),this.render(),this.focus()}createElement(e){e.innerHTML=`<div class="code-editor">
                <div class="gutter"><span>1</span></div>
                <div class="input" contenteditable="true" autocapitalize="off" autocomplete="off" spellcheck="false" autocorrect="off"></div>
            </div>`;const t=e.querySelector("div.code-editor div.gutter"),r=e.querySelector("div.code-editor div.input");return[t,r]}render(){const e=this.getContent(),t=q(this.module,e);let r="",s="";t.forEach(({fragments:i},o)=>{if(i.length===0){s+='<div class="ln"><br></div>',r+=`<span>${o+1}</span>`;return}s+='<div class="ln">';let c=!1,a=!1;i.forEach(({value:l,kind:d,error:u,hint:f})=>{if(d||u||f){let g=[d,u].filter(Boolean).join(" ");s+=`<span class="${g}" title="${f||""}">${l}</span>`}else s+=`<span>${l}</span>`;c=c||d==="move",a=a||d==="error"}),i.length===0&&(s+="<br />"),s+="</div>",a?r+=`<span class="error">${o+1}</span>`:c?r+=`<span class="move">${o+1}</span>`:r+=`<span>${o+1}</span>`}),this.gutter.innerHTML=r,this.input.innerHTML=s,this.dispatchEvent(new Event("render"))}handleInputEvent(e){switch(e.inputType){case"deleteContentForward":return this.deleteForward();case"deleteByCut":case"deleteContentBackward":return this.deleteBackward();case"deleteWordBackward":return this.deleteBackward(!0);case"insertParagraph":case"insertLineBreak":return this.insertLine();case"insertCompositionText":case"insertText":return this.insertText(e.data);case"insertFromPaste":const t=e.dataTransfer?e.dataTransfer.getData("text/plain"):"";return this.insertText(t)}return null}getCaretLineIndex(e,t){if(e===this.input)return t;let r=0;for(const s of this.input.childNodes){if(s===e||s.contains(e))return r;r+=1}throw new Error("CARRET_OUT_OF_RANGE")}getCaretCharIndex(e,t){for(;e!=this.input&&e.parentElement!=this.input;){if(e.previousSibling==null){e=e.parentElement;continue}e=e.previousSibling,t+=e.textContent?e.textContent.length:0}return t}startOfWord(e){const t=this.content[e.lineIndex],r=t.charAt(e.charIndex-1),s=/\s/.test(r)?/\S/:V;for(let i=e.charIndex-1;i>=0;i--)if(s.test(t[i]))return{charIndex:i+1===e.charIndex?i:i+1,lineIndex:e.lineIndex};return{charIndex:0,lineIndex:e.lineIndex}}focus(){this.input.focus()}setContent(e){this.content=e.split(`
`),this.render(),this.setCaret({from:{charIndex:0,lineIndex:0}})}getContent(){return this.content.join(`
`)}getCaret(){const e=document.getSelection();if(!e)return null;try{let t=e.getRangeAt(0);return t.startOffset===t.endOffset&&t.startContainer===t.endContainer?{from:{lineIndex:this.getCaretLineIndex(t.startContainer,t.startOffset),charIndex:this.getCaretCharIndex(t.startContainer,t.startOffset)}}:t.endContainer===this.input?{from:{lineIndex:this.getCaretLineIndex(t.startContainer,t.startOffset),charIndex:this.getCaretCharIndex(t.startContainer,t.startOffset)},to:{lineIndex:this.content.length,charIndex:this.content[this.content.length-1].length}}:{from:{lineIndex:this.getCaretLineIndex(t.startContainer,t.startOffset),charIndex:this.getCaretCharIndex(t.startContainer,t.startOffset)},to:{lineIndex:this.getCaretLineIndex(t.endContainer,t.endOffset-1),charIndex:this.getCaretCharIndex(t.endContainer,t.endOffset)}}}catch{return null}}setCaret(e){if(!e){this.focus();return}const t=window.getSelection();if(!t){this.focus();return}const r=document.createRange();let{lineIndex:s,charIndex:i}=e.from,o=this.input.childNodes[s];if(!o){this.focus();return}const c=l=>l.textContent?l.textContent.length:0;let a=[...o.childNodes];for(;a.length>0;){if(o=a.shift(),!o)continue;if(o.nodeType===Node.ELEMENT_NODE){o.scrollIntoView(),a.unshift(...o.childNodes);continue}const l=c(o);if(i<=l)break;i=i-l}r.setStart(o,Math.min(c(o),i)),r.setEnd(o,Math.min(c(o),i)),t?.removeAllRanges(),t?.addRange(r)}insertLine(){const e=this.getCaret();if(!e)throw new Error("NO_CARET");return e.to&&(this.content=m(this.content,e.from,e.to)),this.content=C(this.content,["",""],e.from),this.render(),{from:{charIndex:0,lineIndex:e.from.lineIndex+1}}}insertText(e){const t=this.getCaret();if(!t)throw new Error("NO_CARET");t.to&&(this.content=m(this.content,t.from,t.to));const r=e.split(`
`);return this.content=C(this.content,r,t.from),this.render(),{from:{charIndex:r.length===1?t.from.charIndex+r[0].length:r[r.length-1].length,lineIndex:r.length===1?t.from.lineIndex:t.from.lineIndex+r.length-1}}}deleteBackward(e){const t=this.getCaret();if(!t)throw new Error("NO_CARET");if(t.to)return this.content=m(this.content,t.from,t.to),this.render(),{from:t.from};if(t.from.charIndex===0&&t.from.lineIndex===0)return t;if(t.from.charIndex===0){const r=this.content[t.from.lineIndex-1].length;return this.content=v(this.content,t.from.lineIndex-1,t.from.lineIndex),this.render(),{from:{lineIndex:t.from.lineIndex-1,charIndex:r}}}if(e){const r=this.startOfWord(t.from);return this.content=m(this.content,r,t.from),this.render(),{from:r}}return this.content=E(this.content,t.from.lineIndex,t.from.charIndex-1,t.from.charIndex),this.render(),{from:{charIndex:t.from.charIndex-1,lineIndex:t.from.lineIndex}}}deleteForward(){const e=this.getCaret();if(!e)throw new Error("NO_CARET");return e.to?(this.content=m(this.content,e.from,e.to),this.render(),{from:e.from}):e.from.charIndex===this.content[e.from.lineIndex].length&&e.from.lineIndex===this.content.length-1?e:e.from.charIndex===this.content[e.from.lineIndex].length?(this.content=v(this.content,e.from.lineIndex,e.from.lineIndex+1),this.render(),{from:e.from}):(this.content=E(this.content,e.from.lineIndex,e.from.charIndex,e.from.charIndex+1),this.render(),{from:e.from})}}const Y=()=>new Promise(n=>{const e=new Worker(new URL("./renderer-M7aCzYON.js",import.meta.url),{type:"module"}),t=r=>{r.data===1&&(e.removeEventListener("message",t),n(e)),e.removeEventListener("message",t)};e.addEventListener("message",t)}),K=async()=>{const n=await Y(),e=await R("./wasm/wasm32-unknown-unknown/release/trtl.wasm"),t=document.querySelector("div#editor"),r=document.querySelector("canvas#canvas");if(y(r),e){const s=new G(t,e);s.addEventListener("render",()=>{n.postMessage({input:s.getContent(),width:r.width,height:r.height})}),window.addEventListener("resize",()=>{y(r),n.postMessage({input:s.getContent(),width:r.width,height:r.height})}),document.querySelector("select").addEventListener("change",o=>{const a=o.target.value;a==="koch"?s.setContent(p.koch.join(`
`)):a==="spiral"?s.setContent(p.spiral.join(`
`)):a==="emoji_test"&&s.setContent(p.emoji_test.join(`
`))}),s.focus(),s.setContent("")}n.addEventListener("message",s=>{if(!r)return;const i=s.data,o=r.getContext("2d");o&&o.putImageData(i,0,0)})};window.addEventListener("DOMContentLoaded",async()=>{await K()});const y=n=>{const e=n.parentElement;e&&(n.width=e.clientWidth??512,n.height=e.clientHeight??512)};
